{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\79046\\\\Desktop\\\\ai-hr-hackaton\\\\ai-hr-hackaton\\\\frontend\\\\src\\\\pages\\\\candidate\\\\Interview.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport './Interview.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Interview = () => {\n  _s();\n  const {\n    sessionId\n  } = useParams();\n  const [ws, setWs] = useState(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [currentTranscript, setCurrentTranscript] = useState('');\n  const [processingResult, setProcessingResult] = useState(null);\n  const [candidateName, setCandidateName] = useState('');\n  const [showNameInput, setShowNameInput] = useState(true);\n  const mediaRecorderRef = useRef(null);\n  const audioChunksRef = useRef([]);\n\n  // Функция для воспроизведения аудио ответа\n  const playAudioResponse = audioBase64 => {\n    try {\n      // Декодируем base64 в blob\n      const audioData = atob(audioBase64);\n      const arrayBuffer = new ArrayBuffer(audioData.length);\n      const uint8Array = new Uint8Array(arrayBuffer);\n      for (let i = 0; i < audioData.length; i++) {\n        uint8Array[i] = audioData.charCodeAt(i);\n      }\n      const blob = new Blob([uint8Array], {\n        type: 'audio/mp3'\n      });\n      const audioUrl = URL.createObjectURL(blob);\n      const audio = new Audio(audioUrl);\n      audio.play().catch(e => console.error('Audio play error:', e));\n\n      // Очищаем URL после воспроизведения\n      audio.onended = () => {\n        URL.revokeObjectURL(audioUrl);\n      };\n    } catch (error) {\n      console.error('Audio decoding error:', error);\n    }\n  };\n\n  // WebSocket подключение\n  useEffect(() => {\n    if (!sessionId) return;\n    const websocket = new WebSocket(`ws://localhost:8000/ws/interview/${sessionId}`);\n    websocket.onopen = () => {\n      console.log('[WebSocket] Подключение установлено');\n      setIsConnected(true);\n    };\n    websocket.onmessage = event => {\n      const message = JSON.parse(event.data);\n      console.log('[WebSocket] Получено:', message);\n      switch (message.type) {\n        case 'welcome':\n          setMessages(prev => [...prev, message]);\n          break;\n        case 'transcript':\n          if (message.is_final) {\n            setCurrentTranscript('');\n            setMessages(prev => [...prev, message]);\n          } else {\n            setCurrentTranscript(message.text || '');\n          }\n          break;\n        case 'question':\n          setMessages(prev => [...prev, message]);\n          break;\n        case 'audio_response':\n          // Воспроизводим аудио ответ\n          if (message.audio_data) {\n            playAudioResponse(message.audio_data);\n          }\n          break;\n        case 'interview_ended':\n          setMessages(prev => [...prev, message]);\n          setIsRecording(false);\n          break;\n        case 'processing_completed':\n          setMessages(prev => [...prev, {\n            type: 'interview_ended',\n            message: 'Обработка завершена! Результаты готовы. Перенаправляем вас на страницу результатов...'\n          }]);\n          setProcessingResult(message.processing_result);\n\n          // Показываем результаты и даем время прочитать сообщение\n          setTimeout(() => {\n            const msgData = message;\n            if (msgData.redirect_to) {\n              window.location.href = msgData.redirect_to;\n            } else if (msgData.results_url) {\n              window.open(msgData.results_url, '_blank');\n              window.location.href = '/hr/results';\n            } else {\n              window.location.href = '/hr/results';\n            }\n          }, 3000);\n          break;\n        case 'info_received':\n          setMessages(prev => [...prev, message]);\n          setShowNameInput(false);\n          break;\n        default:\n          setMessages(prev => [...prev, message]);\n      }\n    };\n    websocket.onclose = () => {\n      console.log('[WebSocket] Соединение закрыто');\n      setIsConnected(false);\n    };\n    websocket.onerror = error => {\n      console.error('[WebSocket] Ошибка:', error);\n    };\n    setWs(websocket);\n    return () => {\n      websocket.close();\n    };\n  }, [sessionId]);\n\n  // Запуск записи аудио\n  const startRecording = async () => {\n    try {\n      console.log('[Recording] Запрашиваю доступ к микрофону...');\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true\n        }\n      });\n      console.log('[Recording] Доступ к микрофону получен');\n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: 'audio/webm;codecs=opus'\n      });\n      mediaRecorder.ondataavailable = event => {\n        if (event.data.size > 0) {\n          audioChunksRef.current.push(event.data);\n          console.log(`[Recording] Получен аудио чанк: ${event.data.size} байт`);\n\n          // Отправляем реальные аудио данные через WebSocket\n          if (ws && ws.readyState === WebSocket.OPEN) {\n            const reader = new FileReader();\n            reader.onload = () => {\n              const arrayBuffer = reader.result;\n              const uint8Array = new Uint8Array(arrayBuffer);\n              const binaryString = Array.from(uint8Array, byte => String.fromCharCode(byte)).join('');\n              const base64 = btoa(binaryString);\n              ws.send(JSON.stringify({\n                type: 'audio_chunk',\n                data: base64,\n                size: event.data.size\n              }));\n            };\n            reader.readAsArrayBuffer(event.data);\n          }\n        }\n      };\n      mediaRecorder.onstop = () => {\n        console.log('[Recording] Запись остановлена');\n        if (audioChunksRef.current.length > 0) {\n          // Создаем финальную запись\n          const audioBlob = new Blob(audioChunksRef.current, {\n            type: 'audio/webm'\n          });\n          console.log(`[Recording] Создан финальный блоб: ${audioBlob.size} байт`);\n\n          // Отправляем финальный сигнал\n          if (ws && ws.readyState === WebSocket.OPEN) {\n            ws.send(JSON.stringify({\n              type: 'recording_finished',\n              total_chunks: audioChunksRef.current.length,\n              total_size: audioBlob.size\n            }));\n          }\n        }\n\n        // Очищаем аудио чанки\n        audioChunksRef.current = [];\n\n        // Останавливаем все треки\n        stream.getTracks().forEach(track => {\n          track.stop();\n          console.log('[Recording] Трек остановлен:', track.kind);\n        });\n      };\n      mediaRecorder.onerror = event => {\n        console.error('[Recording] Ошибка MediaRecorder:', event);\n      };\n      mediaRecorderRef.current = mediaRecorder;\n      mediaRecorder.start(500); // Записываем чанки каждые 500мс\n      setIsRecording(true);\n      console.log('[Recording] Запись началась');\n    } catch (error) {\n      console.error('[Recording] Ошибка доступа к микрофону:', error);\n      let errorMessage = 'Не удалось получить доступ к микрофону: ';\n      if (error.name === 'NotAllowedError') {\n        errorMessage += 'Разрешите доступ к микрофону в браузере';\n      } else if (error.name === 'NotFoundError') {\n        errorMessage += 'Микрофон не найден';\n      } else {\n        errorMessage += error.message || 'Неизвестная ошибка';\n      }\n      alert(errorMessage);\n    }\n  };\n\n  // Остановка записи\n  const stopRecording = () => {\n    console.log('[Recording] Останавливаю запись...');\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n      console.log('[Recording] Команда остановки отправлена');\n    } else {\n      console.log('[Recording] MediaRecorder не активен или уже остановлен');\n      setIsRecording(false);\n    }\n  };\n\n  // Функция для отправки имени кандидата\n  const submitCandidateName = () => {\n    if (ws && ws.readyState === WebSocket.OPEN && candidateName.trim()) {\n      ws.send(JSON.stringify({\n        type: 'candidate_info',\n        name: candidateName.trim()\n      }));\n    }\n  };\n\n  // Функция для перенаправления на страницу настройки микрофона\n  const setupMicrophone = () => {\n    const currentUrl = window.location.href;\n    const setupUrl = `/microphone-permission?return=${encodeURIComponent(currentUrl)}`;\n    window.location.href = setupUrl;\n  };\n\n  // Завершение интервью\n  const endInterview = () => {\n    if (ws && ws.readyState === WebSocket.OPEN) {\n      ws.send(JSON.stringify({\n        type: 'end_interview'\n      }));\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"interview-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"interview-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: [\"\\u0418\\u043D\\u0442\\u0435\\u0440\\u0432\\u044C\\u044E - \\u0421\\u0435\\u0441\\u0441\\u0438\\u044F \", sessionId]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"connection-status\",\n        children: [\"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441: \", isConnected ? '🟢 Подключено' : '🔴 Отключено']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"interview-content\",\n      children: [showNameInput && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"name-input-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"\\u041F\\u0440\\u0435\\u0434\\u0441\\u0442\\u0430\\u0432\\u044C\\u0442\\u0435\\u0441\\u044C, \\u043F\\u043E\\u0436\\u0430\\u043B\\u0443\\u0439\\u0441\\u0442\\u0430:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"name-input\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: candidateName,\n            onChange: e => setCandidateName(e.target.value),\n            placeholder: \"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0432\\u0430\\u0448\\u0435 \\u0438\\u043C\\u044F\",\n            onKeyPress: e => e.key === 'Enter' && submitCandidateName()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: submitCandidateName,\n            disabled: !candidateName.trim(),\n            children: \"\\u041F\\u0440\\u043E\\u0434\\u043E\\u043B\\u0436\\u0438\\u0442\\u044C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 11\n      }, this), !showNameInput && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"messages-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u0438\\u043D\\u0442\\u0435\\u0440\\u0432\\u044C\\u044E:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"messages-list\",\n            children: messages.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `message message-${msg.type}`,\n              children: [msg.type === 'welcome' && /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"\\u0421\\u0438\\u0441\\u0442\\u0435\\u043C\\u0430:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 323,\n                  columnNumber: 26\n                }, this), \" \", msg.message]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 323,\n                columnNumber: 23\n              }, this), msg.type === 'transcript' && /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"\\u0412\\u0430\\u0448 \\u043E\\u0442\\u0432\\u0435\\u0442:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 326,\n                  columnNumber: 26\n                }, this), \" \", msg.text]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 326,\n                columnNumber: 23\n              }, this), msg.type === 'question' && /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: [\"\\u0412\\u043E\\u043F\\u0440\\u043E\\u0441 \", msg.question_number, \":\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 329,\n                  columnNumber: 26\n                }, this), \" \", msg.text]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 329,\n                columnNumber: 23\n              }, this), msg.type === 'interview_ended' && /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"\\u0421\\u0438\\u0441\\u0442\\u0435\\u043C\\u0430:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 332,\n                  columnNumber: 26\n                }, this), \" \", msg.message]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 332,\n                columnNumber: 23\n              }, this), msg.type === 'info_received' && /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"\\u0421\\u0438\\u0441\\u0442\\u0435\\u043C\\u0430:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 335,\n                  columnNumber: 26\n                }, this), \" \", msg.message]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 335,\n                columnNumber: 23\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 321,\n              columnNumber: 19\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 15\n          }, this), currentTranscript && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"current-transcript\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"\\u0421\\u0435\\u0439\\u0447\\u0430\\u0441 \\u0433\\u043E\\u0432\\u043E\\u0440\\u0438\\u0442\\u0435:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 343,\n                columnNumber: 22\n              }, this), \" \", currentTranscript]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 343,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"controls-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"microphone-setup\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: setupMicrophone,\n              className: \"setup-button\",\n              title: \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0438\\u0442\\u044C \\u0434\\u043E\\u0441\\u0442\\u0443\\u043F \\u043A \\u043C\\u0438\\u043A\\u0440\\u043E\\u0444\\u043E\\u043D\\u0443\",\n              children: \"\\uD83D\\uDD10 \\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0438\\u0442\\u044C \\u043C\\u0438\\u043A\\u0440\\u043E\\u0444\\u043E\\u043D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 350,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 349,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"recording-controls\",\n            children: !isRecording ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: startRecording,\n              disabled: !isConnected,\n              className: \"record-button\",\n              children: \"\\uD83C\\uDFA4 \\u041D\\u0430\\u0447\\u0430\\u0442\\u044C \\u0437\\u0430\\u043F\\u0438\\u0441\\u044C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 361,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: stopRecording,\n              className: \"stop-button\",\n              children: \"\\u23F9\\uFE0F \\u041E\\u0441\\u0442\\u0430\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C \\u0437\\u0430\\u043F\\u0438\\u0441\\u044C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"interview-controls\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: endInterview,\n              disabled: !isConnected,\n              className: \"end-button\",\n              children: \"\\u274C \\u0417\\u0430\\u0432\\u0435\\u0440\\u0448\\u0438\\u0442\\u044C \\u0438\\u043D\\u0442\\u0435\\u0440\\u0432\\u044C\\u044E\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 379,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true), processingResult && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"processing-results\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"\\u0420\\u0435\\u0437\\u0443\\u043B\\u044C\\u0442\\u0430\\u0442\\u044B \\u043E\\u0431\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0438:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"results-content\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u0421\\u0442\\u0430\\u0442\\u0443\\u0441:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 395,\n              columnNumber: 18\n            }, this), \" \", processingResult.status]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 395,\n            columnNumber: 15\n          }, this), processingResult.scoring_result && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"scoring-results\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"\\u0420\\u0435\\u0437\\u0443\\u043B\\u044C\\u0442\\u0430\\u0442\\u044B \\u0441\\u043A\\u043E\\u0440\\u0438\\u043D\\u0433\\u0430:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 398,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n              children: JSON.stringify(processingResult.scoring_result, null, 2)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 399,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 288,\n    columnNumber: 5\n  }, this);\n};\n_s(Interview, \"HGd11K4uaAmOpRE6fb86WFfduA8=\", false, function () {\n  return [useParams];\n});\n_c = Interview;\nexport default Interview;\nvar _c;\n$RefreshReg$(_c, \"Interview\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","jsxDEV","_jsxDEV","Fragment","_Fragment","Interview","_s","sessionId","ws","setWs","isConnected","setIsConnected","isRecording","setIsRecording","messages","setMessages","currentTranscript","setCurrentTranscript","processingResult","setProcessingResult","candidateName","setCandidateName","showNameInput","setShowNameInput","mediaRecorderRef","audioChunksRef","playAudioResponse","audioBase64","audioData","atob","arrayBuffer","ArrayBuffer","length","uint8Array","Uint8Array","i","charCodeAt","blob","Blob","type","audioUrl","URL","createObjectURL","audio","Audio","play","catch","e","console","error","onended","revokeObjectURL","websocket","WebSocket","onopen","log","onmessage","event","message","JSON","parse","data","prev","is_final","text","audio_data","processing_result","setTimeout","msgData","redirect_to","window","location","href","results_url","open","onclose","onerror","close","startRecording","stream","navigator","mediaDevices","getUserMedia","echoCancellation","noiseSuppression","autoGainControl","mediaRecorder","MediaRecorder","mimeType","ondataavailable","size","current","push","readyState","OPEN","reader","FileReader","onload","result","binaryString","Array","from","byte","String","fromCharCode","join","base64","btoa","send","stringify","readAsArrayBuffer","onstop","audioBlob","total_chunks","total_size","getTracks","forEach","track","stop","kind","start","errorMessage","name","alert","stopRecording","state","submitCandidateName","trim","setupMicrophone","currentUrl","setupUrl","encodeURIComponent","endInterview","className","children","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","target","placeholder","onKeyPress","key","onClick","disabled","map","msg","index","question_number","title","status","scoring_result","_c","$RefreshReg$"],"sources":["C:/Users/79046/Desktop/ai-hr-hackaton/ai-hr-hackaton/frontend/src/pages/candidate/Interview.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport './Interview.css';\r\n\r\ninterface Message {\r\n  type: 'welcome' | 'transcript' | 'question' | 'interview_ended' | 'audio_response' | 'processing_completed' | 'info_received';\r\n  text?: string;\r\n  message?: string;\r\n  is_final?: boolean;\r\n  question_number?: number;\r\n  audio_data?: string;\r\n  processing_result?: any;\r\n  redirect_to?: string;\r\n  results_url?: string;\r\n}\r\n\r\nconst Interview: React.FC = () => {\r\n  const { sessionId } = useParams<{ sessionId: string }>();\r\n  const [ws, setWs] = useState<WebSocket | null>(null);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [isRecording, setIsRecording] = useState(false);\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [currentTranscript, setCurrentTranscript] = useState('');\r\n  const [processingResult, setProcessingResult] = useState<any>(null);\r\n  const [candidateName, setCandidateName] = useState('');\r\n  const [showNameInput, setShowNameInput] = useState(true);\r\n  \r\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n  const audioChunksRef = useRef<Blob[]>([]);\r\n\r\n  // Функция для воспроизведения аудио ответа\r\n  const playAudioResponse = (audioBase64: string) => {\r\n    try {\r\n      // Декодируем base64 в blob\r\n      const audioData = atob(audioBase64);\r\n      const arrayBuffer = new ArrayBuffer(audioData.length);\r\n      const uint8Array = new Uint8Array(arrayBuffer);\r\n      \r\n      for (let i = 0; i < audioData.length; i++) {\r\n        uint8Array[i] = audioData.charCodeAt(i);\r\n      }\r\n      \r\n      const blob = new Blob([uint8Array], { type: 'audio/mp3' });\r\n      const audioUrl = URL.createObjectURL(blob);\r\n      \r\n      const audio = new Audio(audioUrl);\r\n      audio.play().catch(e => console.error('Audio play error:', e));\r\n      \r\n      // Очищаем URL после воспроизведения\r\n      audio.onended = () => {\r\n        URL.revokeObjectURL(audioUrl);\r\n      };\r\n    } catch (error) {\r\n      console.error('Audio decoding error:', error);\r\n    }\r\n  };\r\n\r\n  // WebSocket подключение\r\n  useEffect(() => {\r\n    if (!sessionId) return;\r\n\r\n    const websocket = new WebSocket(`ws://localhost:8000/ws/interview/${sessionId}`);\r\n    \r\n    websocket.onopen = () => {\r\n      console.log('[WebSocket] Подключение установлено');\r\n      setIsConnected(true);\r\n    };\r\n\r\n    websocket.onmessage = (event) => {\r\n      const message: Message = JSON.parse(event.data);\r\n      console.log('[WebSocket] Получено:', message);\r\n      \r\n      switch (message.type) {\r\n        case 'welcome':\r\n          setMessages(prev => [...prev, message]);\r\n          break;\r\n          \r\n        case 'transcript':\r\n          if (message.is_final) {\r\n            setCurrentTranscript('');\r\n            setMessages(prev => [...prev, message]);\r\n          } else {\r\n            setCurrentTranscript(message.text || '');\r\n          }\r\n          break;\r\n          \r\n        case 'question':\r\n          setMessages(prev => [...prev, message]);\r\n          break;\r\n          \r\n        case 'audio_response':\r\n          // Воспроизводим аудио ответ\r\n          if (message.audio_data) {\r\n            playAudioResponse(message.audio_data);\r\n          }\r\n          break;\r\n          \r\n        case 'interview_ended':\r\n          setMessages(prev => [...prev, message]);\r\n          setIsRecording(false);\r\n          break;\r\n          \r\n        case 'processing_completed':\r\n          setMessages(prev => [...prev, {\r\n            type: 'interview_ended',\r\n            message: 'Обработка завершена! Результаты готовы. Перенаправляем вас на страницу результатов...'\r\n          }]);\r\n          setProcessingResult(message.processing_result);\r\n          \r\n          // Показываем результаты и даем время прочитать сообщение\r\n          setTimeout(() => {\r\n            const msgData = message as any;\r\n            if (msgData.redirect_to) {\r\n              window.location.href = msgData.redirect_to;\r\n            } else if (msgData.results_url) {\r\n              window.open(msgData.results_url, '_blank');\r\n              window.location.href = '/hr/results';\r\n            } else {\r\n              window.location.href = '/hr/results';\r\n            }\r\n          }, 3000);\r\n          break;\r\n          \r\n        case 'info_received':\r\n          setMessages(prev => [...prev, message]);\r\n          setShowNameInput(false);\r\n          break;\r\n          \r\n        default:\r\n          setMessages(prev => [...prev, message]);\r\n      }\r\n    };\r\n\r\n    websocket.onclose = () => {\r\n      console.log('[WebSocket] Соединение закрыто');\r\n      setIsConnected(false);\r\n    };\r\n\r\n    websocket.onerror = (error) => {\r\n      console.error('[WebSocket] Ошибка:', error);\r\n    };\r\n\r\n    setWs(websocket);\r\n\r\n    return () => {\r\n      websocket.close();\r\n    };\r\n  }, [sessionId]);\r\n\r\n  // Запуск записи аудио\r\n  const startRecording = async () => {\r\n    try {\r\n      console.log('[Recording] Запрашиваю доступ к микрофону...');\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({ \r\n        audio: {\r\n          echoCancellation: true,\r\n          noiseSuppression: true,\r\n          autoGainControl: true\r\n        } \r\n      });\r\n      \r\n      console.log('[Recording] Доступ к микрофону получен');\r\n      \r\n      const mediaRecorder = new MediaRecorder(stream, {\r\n        mimeType: 'audio/webm;codecs=opus'\r\n      });\r\n      \r\n      mediaRecorder.ondataavailable = (event) => {\r\n        if (event.data.size > 0) {\r\n          audioChunksRef.current.push(event.data);\r\n          console.log(`[Recording] Получен аудио чанк: ${event.data.size} байт`);\r\n          \r\n          // Отправляем реальные аудио данные через WebSocket\r\n          if (ws && ws.readyState === WebSocket.OPEN) {\r\n            const reader = new FileReader();\r\n            reader.onload = () => {\r\n              const arrayBuffer = reader.result as ArrayBuffer;\r\n              const uint8Array = new Uint8Array(arrayBuffer);\r\n              const binaryString = Array.from(uint8Array, byte => String.fromCharCode(byte)).join('');\r\n              const base64 = btoa(binaryString);\r\n              \r\n              ws.send(JSON.stringify({\r\n                type: 'audio_chunk',\r\n                data: base64,\r\n                size: event.data.size\r\n              }));\r\n            };\r\n            reader.readAsArrayBuffer(event.data);\r\n          }\r\n        }\r\n      };\r\n\r\n      mediaRecorder.onstop = () => {\r\n        console.log('[Recording] Запись остановлена');\r\n        \r\n        if (audioChunksRef.current.length > 0) {\r\n          // Создаем финальную запись\r\n          const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\r\n          console.log(`[Recording] Создан финальный блоб: ${audioBlob.size} байт`);\r\n          \r\n          // Отправляем финальный сигнал\r\n          if (ws && ws.readyState === WebSocket.OPEN) {\r\n            ws.send(JSON.stringify({\r\n              type: 'recording_finished',\r\n              total_chunks: audioChunksRef.current.length,\r\n              total_size: audioBlob.size\r\n            }));\r\n          }\r\n        }\r\n        \r\n        // Очищаем аудио чанки\r\n        audioChunksRef.current = [];\r\n        \r\n        // Останавливаем все треки\r\n        stream.getTracks().forEach(track => {\r\n          track.stop();\r\n          console.log('[Recording] Трек остановлен:', track.kind);\r\n        });\r\n      };\r\n\r\n      mediaRecorder.onerror = (event) => {\r\n        console.error('[Recording] Ошибка MediaRecorder:', event);\r\n      };\r\n\r\n      mediaRecorderRef.current = mediaRecorder;\r\n      mediaRecorder.start(500); // Записываем чанки каждые 500мс\r\n      setIsRecording(true);\r\n      \r\n      console.log('[Recording] Запись началась');\r\n      \r\n    } catch (error: any) {\r\n      console.error('[Recording] Ошибка доступа к микрофону:', error);\r\n      \r\n      let errorMessage = 'Не удалось получить доступ к микрофону: ';\r\n      \r\n      if (error.name === 'NotAllowedError') {\r\n        errorMessage += 'Разрешите доступ к микрофону в браузере';\r\n      } else if (error.name === 'NotFoundError') {\r\n        errorMessage += 'Микрофон не найден';\r\n      } else {\r\n        errorMessage += error.message || 'Неизвестная ошибка';\r\n      }\r\n      \r\n      alert(errorMessage);\r\n    }\r\n  };\r\n\r\n  // Остановка записи\r\n  const stopRecording = () => {\r\n    console.log('[Recording] Останавливаю запись...');\r\n    \r\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {\r\n      mediaRecorderRef.current.stop();\r\n      setIsRecording(false);\r\n      console.log('[Recording] Команда остановки отправлена');\r\n    } else {\r\n      console.log('[Recording] MediaRecorder не активен или уже остановлен');\r\n      setIsRecording(false);\r\n    }\r\n  };\r\n\r\n  // Функция для отправки имени кандидата\r\n  const submitCandidateName = () => {\r\n    if (ws && ws.readyState === WebSocket.OPEN && candidateName.trim()) {\r\n      ws.send(JSON.stringify({ \r\n        type: 'candidate_info', \r\n        name: candidateName.trim() \r\n      }));\r\n    }\r\n  };\r\n\r\n  // Функция для перенаправления на страницу настройки микрофона\r\n  const setupMicrophone = () => {\r\n    const currentUrl = window.location.href;\r\n    const setupUrl = `/microphone-permission?return=${encodeURIComponent(currentUrl)}`;\r\n    window.location.href = setupUrl;\r\n  };\r\n\r\n  // Завершение интервью\r\n  const endInterview = () => {\r\n    if (ws && ws.readyState === WebSocket.OPEN) {\r\n      ws.send(JSON.stringify({ type: 'end_interview' }));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"interview-container\">\r\n      <div className=\"interview-header\">\r\n        <h1>Интервью - Сессия {sessionId}</h1>\r\n        <div className=\"connection-status\">\r\n          Статус: {isConnected ? '🟢 Подключено' : '🔴 Отключено'}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"interview-content\">\r\n        {showNameInput && (\r\n          <div className=\"name-input-section\">\r\n            <h3>Представьтесь, пожалуйста:</h3>\r\n            <div className=\"name-input\">\r\n              <input\r\n                type=\"text\"\r\n                value={candidateName}\r\n                onChange={(e) => setCandidateName(e.target.value)}\r\n                placeholder=\"Введите ваше имя\"\r\n                onKeyPress={(e) => e.key === 'Enter' && submitCandidateName()}\r\n              />\r\n              <button onClick={submitCandidateName} disabled={!candidateName.trim()}>\r\n                Продолжить\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n        \r\n        {!showNameInput && (\r\n          <>\r\n            <div className=\"messages-section\">\r\n              <h3>История интервью:</h3>\r\n              <div className=\"messages-list\">\r\n                {messages.map((msg, index) => (\r\n                  <div key={index} className={`message message-${msg.type}`}>\r\n                    {msg.type === 'welcome' && (\r\n                      <p><strong>Система:</strong> {msg.message}</p>\r\n                    )}\r\n                    {msg.type === 'transcript' && (\r\n                      <p><strong>Ваш ответ:</strong> {msg.text}</p>\r\n                    )}\r\n                    {msg.type === 'question' && (\r\n                      <p><strong>Вопрос {msg.question_number}:</strong> {msg.text}</p>\r\n                    )}\r\n                    {msg.type === 'interview_ended' && (\r\n                      <p><strong>Система:</strong> {msg.message}</p>\r\n                    )}\r\n                    {msg.type === 'info_received' && (\r\n                      <p><strong>Система:</strong> {msg.message}</p>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              \r\n              {currentTranscript && (\r\n                <div className=\"current-transcript\">\r\n                  <p><strong>Сейчас говорите:</strong> {currentTranscript}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"controls-section\">\r\n              <div className=\"microphone-setup\">\r\n                <button \r\n                  onClick={setupMicrophone}\r\n                  className=\"setup-button\"\r\n                  title=\"Настроить доступ к микрофону\"\r\n                >\r\n                  🔐 Настроить микрофон\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"recording-controls\">\r\n                {!isRecording ? (\r\n                  <button \r\n                    onClick={startRecording} \r\n                    disabled={!isConnected}\r\n                    className=\"record-button\"\r\n                  >\r\n                    🎤 Начать запись\r\n                  </button>\r\n                ) : (\r\n                  <button \r\n                    onClick={stopRecording}\r\n                    className=\"stop-button\"\r\n                  >\r\n                    ⏹️ Остановить запись\r\n                  </button>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"interview-controls\">\r\n                <button \r\n                  onClick={endInterview}\r\n                  disabled={!isConnected}\r\n                  className=\"end-button\"\r\n                >\r\n                  ❌ Завершить интервью\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n        \r\n        {processingResult && (\r\n          <div className=\"processing-results\">\r\n            <h3>Результаты обработки:</h3>\r\n            <div className=\"results-content\">\r\n              <p><strong>Статус:</strong> {processingResult.status}</p>\r\n              {processingResult.scoring_result && (\r\n                <div className=\"scoring-results\">\r\n                  <h4>Результаты скоринга:</h4>\r\n                  <pre>{JSON.stringify(processingResult.scoring_result, null, 2)}</pre>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Interview;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,SAASC,SAAS,QAAQ,kBAAkB;AAC5C,OAAO,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAczB,MAAMC,SAAmB,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAChC,MAAM;IAAEC;EAAU,CAAC,GAAGP,SAAS,CAAwB,CAAC;EACxD,MAAM,CAACQ,EAAE,EAAEC,KAAK,CAAC,GAAGZ,QAAQ,CAAmB,IAAI,CAAC;EACpD,MAAM,CAACa,WAAW,EAAEC,cAAc,CAAC,GAAGd,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACe,WAAW,EAAEC,cAAc,CAAC,GAAGhB,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACiB,QAAQ,EAAEC,WAAW,CAAC,GAAGlB,QAAQ,CAAY,EAAE,CAAC;EACvD,MAAM,CAACmB,iBAAiB,EAAEC,oBAAoB,CAAC,GAAGpB,QAAQ,CAAC,EAAE,CAAC;EAC9D,MAAM,CAACqB,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGtB,QAAQ,CAAM,IAAI,CAAC;EACnE,MAAM,CAACuB,aAAa,EAAEC,gBAAgB,CAAC,GAAGxB,QAAQ,CAAC,EAAE,CAAC;EACtD,MAAM,CAACyB,aAAa,EAAEC,gBAAgB,CAAC,GAAG1B,QAAQ,CAAC,IAAI,CAAC;EAExD,MAAM2B,gBAAgB,GAAGzB,MAAM,CAAuB,IAAI,CAAC;EAC3D,MAAM0B,cAAc,GAAG1B,MAAM,CAAS,EAAE,CAAC;;EAEzC;EACA,MAAM2B,iBAAiB,GAAIC,WAAmB,IAAK;IACjD,IAAI;MACF;MACA,MAAMC,SAAS,GAAGC,IAAI,CAACF,WAAW,CAAC;MACnC,MAAMG,WAAW,GAAG,IAAIC,WAAW,CAACH,SAAS,CAACI,MAAM,CAAC;MACrD,MAAMC,UAAU,GAAG,IAAIC,UAAU,CAACJ,WAAW,CAAC;MAE9C,KAAK,IAAIK,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGP,SAAS,CAACI,MAAM,EAAEG,CAAC,EAAE,EAAE;QACzCF,UAAU,CAACE,CAAC,CAAC,GAAGP,SAAS,CAACQ,UAAU,CAACD,CAAC,CAAC;MACzC;MAEA,MAAME,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACL,UAAU,CAAC,EAAE;QAAEM,IAAI,EAAE;MAAY,CAAC,CAAC;MAC1D,MAAMC,QAAQ,GAAGC,GAAG,CAACC,eAAe,CAACL,IAAI,CAAC;MAE1C,MAAMM,KAAK,GAAG,IAAIC,KAAK,CAACJ,QAAQ,CAAC;MACjCG,KAAK,CAACE,IAAI,CAAC,CAAC,CAACC,KAAK,CAACC,CAAC,IAAIC,OAAO,CAACC,KAAK,CAAC,mBAAmB,EAAEF,CAAC,CAAC,CAAC;;MAE9D;MACAJ,KAAK,CAACO,OAAO,GAAG,MAAM;QACpBT,GAAG,CAACU,eAAe,CAACX,QAAQ,CAAC;MAC/B,CAAC;IACH,CAAC,CAAC,OAAOS,KAAK,EAAE;MACdD,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;IAC/C;EACF,CAAC;;EAED;EACAnD,SAAS,CAAC,MAAM;IACd,IAAI,CAACS,SAAS,EAAE;IAEhB,MAAM6C,SAAS,GAAG,IAAIC,SAAS,CAAC,oCAAoC9C,SAAS,EAAE,CAAC;IAEhF6C,SAAS,CAACE,MAAM,GAAG,MAAM;MACvBN,OAAO,CAACO,GAAG,CAAC,qCAAqC,CAAC;MAClD5C,cAAc,CAAC,IAAI,CAAC;IACtB,CAAC;IAEDyC,SAAS,CAACI,SAAS,GAAIC,KAAK,IAAK;MAC/B,MAAMC,OAAgB,GAAGC,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,CAAC;MAC/Cb,OAAO,CAACO,GAAG,CAAC,uBAAuB,EAAEG,OAAO,CAAC;MAE7C,QAAQA,OAAO,CAACnB,IAAI;QAClB,KAAK,SAAS;UACZxB,WAAW,CAAC+C,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEJ,OAAO,CAAC,CAAC;UACvC;QAEF,KAAK,YAAY;UACf,IAAIA,OAAO,CAACK,QAAQ,EAAE;YACpB9C,oBAAoB,CAAC,EAAE,CAAC;YACxBF,WAAW,CAAC+C,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEJ,OAAO,CAAC,CAAC;UACzC,CAAC,MAAM;YACLzC,oBAAoB,CAACyC,OAAO,CAACM,IAAI,IAAI,EAAE,CAAC;UAC1C;UACA;QAEF,KAAK,UAAU;UACbjD,WAAW,CAAC+C,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEJ,OAAO,CAAC,CAAC;UACvC;QAEF,KAAK,gBAAgB;UACnB;UACA,IAAIA,OAAO,CAACO,UAAU,EAAE;YACtBvC,iBAAiB,CAACgC,OAAO,CAACO,UAAU,CAAC;UACvC;UACA;QAEF,KAAK,iBAAiB;UACpBlD,WAAW,CAAC+C,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEJ,OAAO,CAAC,CAAC;UACvC7C,cAAc,CAAC,KAAK,CAAC;UACrB;QAEF,KAAK,sBAAsB;UACzBE,WAAW,CAAC+C,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;YAC5BvB,IAAI,EAAE,iBAAiB;YACvBmB,OAAO,EAAE;UACX,CAAC,CAAC,CAAC;UACHvC,mBAAmB,CAACuC,OAAO,CAACQ,iBAAiB,CAAC;;UAE9C;UACAC,UAAU,CAAC,MAAM;YACf,MAAMC,OAAO,GAAGV,OAAc;YAC9B,IAAIU,OAAO,CAACC,WAAW,EAAE;cACvBC,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAGJ,OAAO,CAACC,WAAW;YAC5C,CAAC,MAAM,IAAID,OAAO,CAACK,WAAW,EAAE;cAC9BH,MAAM,CAACI,IAAI,CAACN,OAAO,CAACK,WAAW,EAAE,QAAQ,CAAC;cAC1CH,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,aAAa;YACtC,CAAC,MAAM;cACLF,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG,aAAa;YACtC;UACF,CAAC,EAAE,IAAI,CAAC;UACR;QAEF,KAAK,eAAe;UAClBzD,WAAW,CAAC+C,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEJ,OAAO,CAAC,CAAC;UACvCnC,gBAAgB,CAAC,KAAK,CAAC;UACvB;QAEF;UACER,WAAW,CAAC+C,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEJ,OAAO,CAAC,CAAC;MAC3C;IACF,CAAC;IAEDN,SAAS,CAACuB,OAAO,GAAG,MAAM;MACxB3B,OAAO,CAACO,GAAG,CAAC,gCAAgC,CAAC;MAC7C5C,cAAc,CAAC,KAAK,CAAC;IACvB,CAAC;IAEDyC,SAAS,CAACwB,OAAO,GAAI3B,KAAK,IAAK;MAC7BD,OAAO,CAACC,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;IAC7C,CAAC;IAEDxC,KAAK,CAAC2C,SAAS,CAAC;IAEhB,OAAO,MAAM;MACXA,SAAS,CAACyB,KAAK,CAAC,CAAC;IACnB,CAAC;EACH,CAAC,EAAE,CAACtE,SAAS,CAAC,CAAC;;EAEf;EACA,MAAMuE,cAAc,GAAG,MAAAA,CAAA,KAAY;IACjC,IAAI;MACF9B,OAAO,CAACO,GAAG,CAAC,8CAA8C,CAAC;MAE3D,MAAMwB,MAAM,GAAG,MAAMC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;QACvDvC,KAAK,EAAE;UACLwC,gBAAgB,EAAE,IAAI;UACtBC,gBAAgB,EAAE,IAAI;UACtBC,eAAe,EAAE;QACnB;MACF,CAAC,CAAC;MAEFrC,OAAO,CAACO,GAAG,CAAC,wCAAwC,CAAC;MAErD,MAAM+B,aAAa,GAAG,IAAIC,aAAa,CAACR,MAAM,EAAE;QAC9CS,QAAQ,EAAE;MACZ,CAAC,CAAC;MAEFF,aAAa,CAACG,eAAe,GAAIhC,KAAK,IAAK;QACzC,IAAIA,KAAK,CAACI,IAAI,CAAC6B,IAAI,GAAG,CAAC,EAAE;UACvBjE,cAAc,CAACkE,OAAO,CAACC,IAAI,CAACnC,KAAK,CAACI,IAAI,CAAC;UACvCb,OAAO,CAACO,GAAG,CAAC,mCAAmCE,KAAK,CAACI,IAAI,CAAC6B,IAAI,OAAO,CAAC;;UAEtE;UACA,IAAIlF,EAAE,IAAIA,EAAE,CAACqF,UAAU,KAAKxC,SAAS,CAACyC,IAAI,EAAE;YAC1C,MAAMC,MAAM,GAAG,IAAIC,UAAU,CAAC,CAAC;YAC/BD,MAAM,CAACE,MAAM,GAAG,MAAM;cACpB,MAAMnE,WAAW,GAAGiE,MAAM,CAACG,MAAqB;cAChD,MAAMjE,UAAU,GAAG,IAAIC,UAAU,CAACJ,WAAW,CAAC;cAC9C,MAAMqE,YAAY,GAAGC,KAAK,CAACC,IAAI,CAACpE,UAAU,EAAEqE,IAAI,IAAIC,MAAM,CAACC,YAAY,CAACF,IAAI,CAAC,CAAC,CAACG,IAAI,CAAC,EAAE,CAAC;cACvF,MAAMC,MAAM,GAAGC,IAAI,CAACR,YAAY,CAAC;cAEjC3F,EAAE,CAACoG,IAAI,CAACjD,IAAI,CAACkD,SAAS,CAAC;gBACrBtE,IAAI,EAAE,aAAa;gBACnBsB,IAAI,EAAE6C,MAAM;gBACZhB,IAAI,EAAEjC,KAAK,CAACI,IAAI,CAAC6B;cACnB,CAAC,CAAC,CAAC;YACL,CAAC;YACDK,MAAM,CAACe,iBAAiB,CAACrD,KAAK,CAACI,IAAI,CAAC;UACtC;QACF;MACF,CAAC;MAEDyB,aAAa,CAACyB,MAAM,GAAG,MAAM;QAC3B/D,OAAO,CAACO,GAAG,CAAC,gCAAgC,CAAC;QAE7C,IAAI9B,cAAc,CAACkE,OAAO,CAAC3D,MAAM,GAAG,CAAC,EAAE;UACrC;UACA,MAAMgF,SAAS,GAAG,IAAI1E,IAAI,CAACb,cAAc,CAACkE,OAAO,EAAE;YAAEpD,IAAI,EAAE;UAAa,CAAC,CAAC;UAC1ES,OAAO,CAACO,GAAG,CAAC,sCAAsCyD,SAAS,CAACtB,IAAI,OAAO,CAAC;;UAExE;UACA,IAAIlF,EAAE,IAAIA,EAAE,CAACqF,UAAU,KAAKxC,SAAS,CAACyC,IAAI,EAAE;YAC1CtF,EAAE,CAACoG,IAAI,CAACjD,IAAI,CAACkD,SAAS,CAAC;cACrBtE,IAAI,EAAE,oBAAoB;cAC1B0E,YAAY,EAAExF,cAAc,CAACkE,OAAO,CAAC3D,MAAM;cAC3CkF,UAAU,EAAEF,SAAS,CAACtB;YACxB,CAAC,CAAC,CAAC;UACL;QACF;;QAEA;QACAjE,cAAc,CAACkE,OAAO,GAAG,EAAE;;QAE3B;QACAZ,MAAM,CAACoC,SAAS,CAAC,CAAC,CAACC,OAAO,CAACC,KAAK,IAAI;UAClCA,KAAK,CAACC,IAAI,CAAC,CAAC;UACZtE,OAAO,CAACO,GAAG,CAAC,8BAA8B,EAAE8D,KAAK,CAACE,IAAI,CAAC;QACzD,CAAC,CAAC;MACJ,CAAC;MAEDjC,aAAa,CAACV,OAAO,GAAInB,KAAK,IAAK;QACjCT,OAAO,CAACC,KAAK,CAAC,mCAAmC,EAAEQ,KAAK,CAAC;MAC3D,CAAC;MAEDjC,gBAAgB,CAACmE,OAAO,GAAGL,aAAa;MACxCA,aAAa,CAACkC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;MAC1B3G,cAAc,CAAC,IAAI,CAAC;MAEpBmC,OAAO,CAACO,GAAG,CAAC,6BAA6B,CAAC;IAE5C,CAAC,CAAC,OAAON,KAAU,EAAE;MACnBD,OAAO,CAACC,KAAK,CAAC,yCAAyC,EAAEA,KAAK,CAAC;MAE/D,IAAIwE,YAAY,GAAG,0CAA0C;MAE7D,IAAIxE,KAAK,CAACyE,IAAI,KAAK,iBAAiB,EAAE;QACpCD,YAAY,IAAI,yCAAyC;MAC3D,CAAC,MAAM,IAAIxE,KAAK,CAACyE,IAAI,KAAK,eAAe,EAAE;QACzCD,YAAY,IAAI,oBAAoB;MACtC,CAAC,MAAM;QACLA,YAAY,IAAIxE,KAAK,CAACS,OAAO,IAAI,oBAAoB;MACvD;MAEAiE,KAAK,CAACF,YAAY,CAAC;IACrB;EACF,CAAC;;EAED;EACA,MAAMG,aAAa,GAAGA,CAAA,KAAM;IAC1B5E,OAAO,CAACO,GAAG,CAAC,oCAAoC,CAAC;IAEjD,IAAI/B,gBAAgB,CAACmE,OAAO,IAAInE,gBAAgB,CAACmE,OAAO,CAACkC,KAAK,KAAK,WAAW,EAAE;MAC9ErG,gBAAgB,CAACmE,OAAO,CAAC2B,IAAI,CAAC,CAAC;MAC/BzG,cAAc,CAAC,KAAK,CAAC;MACrBmC,OAAO,CAACO,GAAG,CAAC,0CAA0C,CAAC;IACzD,CAAC,MAAM;MACLP,OAAO,CAACO,GAAG,CAAC,yDAAyD,CAAC;MACtE1C,cAAc,CAAC,KAAK,CAAC;IACvB;EACF,CAAC;;EAED;EACA,MAAMiH,mBAAmB,GAAGA,CAAA,KAAM;IAChC,IAAItH,EAAE,IAAIA,EAAE,CAACqF,UAAU,KAAKxC,SAAS,CAACyC,IAAI,IAAI1E,aAAa,CAAC2G,IAAI,CAAC,CAAC,EAAE;MAClEvH,EAAE,CAACoG,IAAI,CAACjD,IAAI,CAACkD,SAAS,CAAC;QACrBtE,IAAI,EAAE,gBAAgB;QACtBmF,IAAI,EAAEtG,aAAa,CAAC2G,IAAI,CAAC;MAC3B,CAAC,CAAC,CAAC;IACL;EACF,CAAC;;EAED;EACA,MAAMC,eAAe,GAAGA,CAAA,KAAM;IAC5B,MAAMC,UAAU,GAAG3D,MAAM,CAACC,QAAQ,CAACC,IAAI;IACvC,MAAM0D,QAAQ,GAAG,iCAAiCC,kBAAkB,CAACF,UAAU,CAAC,EAAE;IAClF3D,MAAM,CAACC,QAAQ,CAACC,IAAI,GAAG0D,QAAQ;EACjC,CAAC;;EAED;EACA,MAAME,YAAY,GAAGA,CAAA,KAAM;IACzB,IAAI5H,EAAE,IAAIA,EAAE,CAACqF,UAAU,KAAKxC,SAAS,CAACyC,IAAI,EAAE;MAC1CtF,EAAE,CAACoG,IAAI,CAACjD,IAAI,CAACkD,SAAS,CAAC;QAAEtE,IAAI,EAAE;MAAgB,CAAC,CAAC,CAAC;IACpD;EACF,CAAC;EAED,oBACErC,OAAA;IAAKmI,SAAS,EAAC,qBAAqB;IAAAC,QAAA,gBAClCpI,OAAA;MAAKmI,SAAS,EAAC,kBAAkB;MAAAC,QAAA,gBAC/BpI,OAAA;QAAAoI,QAAA,GAAI,0FAAkB,EAAC/H,SAAS;MAAA;QAAAgI,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAK,CAAC,eACtCxI,OAAA;QAAKmI,SAAS,EAAC,mBAAmB;QAAAC,QAAA,GAAC,wCACzB,EAAC5H,WAAW,GAAG,eAAe,GAAG,cAAc;MAAA;QAAA6H,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACpD,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,eAENxI,OAAA;MAAKmI,SAAS,EAAC,mBAAmB;MAAAC,QAAA,GAC/BhH,aAAa,iBACZpB,OAAA;QAAKmI,SAAS,EAAC,oBAAoB;QAAAC,QAAA,gBACjCpI,OAAA;UAAAoI,QAAA,EAAI;QAA0B;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eACnCxI,OAAA;UAAKmI,SAAS,EAAC,YAAY;UAAAC,QAAA,gBACzBpI,OAAA;YACEqC,IAAI,EAAC,MAAM;YACXoG,KAAK,EAAEvH,aAAc;YACrBwH,QAAQ,EAAG7F,CAAC,IAAK1B,gBAAgB,CAAC0B,CAAC,CAAC8F,MAAM,CAACF,KAAK,CAAE;YAClDG,WAAW,EAAC,wFAAkB;YAC9BC,UAAU,EAAGhG,CAAC,IAAKA,CAAC,CAACiG,GAAG,KAAK,OAAO,IAAIlB,mBAAmB,CAAC;UAAE;YAAAS,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC/D,CAAC,eACFxI,OAAA;YAAQ+I,OAAO,EAAEnB,mBAAoB;YAACoB,QAAQ,EAAE,CAAC9H,aAAa,CAAC2G,IAAI,CAAC,CAAE;YAAAO,QAAA,EAAC;UAEvE;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CACN,EAEA,CAACpH,aAAa,iBACbpB,OAAA,CAAAE,SAAA;QAAAkI,QAAA,gBACEpI,OAAA;UAAKmI,SAAS,EAAC,kBAAkB;UAAAC,QAAA,gBAC/BpI,OAAA;YAAAoI,QAAA,EAAI;UAAiB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eAC1BxI,OAAA;YAAKmI,SAAS,EAAC,eAAe;YAAAC,QAAA,EAC3BxH,QAAQ,CAACqI,GAAG,CAAC,CAACC,GAAG,EAAEC,KAAK,kBACvBnJ,OAAA;cAAiBmI,SAAS,EAAE,mBAAmBe,GAAG,CAAC7G,IAAI,EAAG;cAAA+F,QAAA,GACvDc,GAAG,CAAC7G,IAAI,KAAK,SAAS,iBACrBrC,OAAA;gBAAAoI,QAAA,gBAAGpI,OAAA;kBAAAoI,QAAA,EAAQ;gBAAQ;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAQ,CAAC,KAAC,EAACU,GAAG,CAAC1F,OAAO;cAAA;gBAAA6E,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAC9C,EACAU,GAAG,CAAC7G,IAAI,KAAK,YAAY,iBACxBrC,OAAA;gBAAAoI,QAAA,gBAAGpI,OAAA;kBAAAoI,QAAA,EAAQ;gBAAU;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAQ,CAAC,KAAC,EAACU,GAAG,CAACpF,IAAI;cAAA;gBAAAuE,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAC7C,EACAU,GAAG,CAAC7G,IAAI,KAAK,UAAU,iBACtBrC,OAAA;gBAAAoI,QAAA,gBAAGpI,OAAA;kBAAAoI,QAAA,GAAQ,uCAAO,EAACc,GAAG,CAACE,eAAe,EAAC,GAAC;gBAAA;kBAAAf,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAQ,CAAC,KAAC,EAACU,GAAG,CAACpF,IAAI;cAAA;gBAAAuE,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAChE,EACAU,GAAG,CAAC7G,IAAI,KAAK,iBAAiB,iBAC7BrC,OAAA;gBAAAoI,QAAA,gBAAGpI,OAAA;kBAAAoI,QAAA,EAAQ;gBAAQ;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAQ,CAAC,KAAC,EAACU,GAAG,CAAC1F,OAAO;cAAA;gBAAA6E,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAC9C,EACAU,GAAG,CAAC7G,IAAI,KAAK,eAAe,iBAC3BrC,OAAA;gBAAAoI,QAAA,gBAAGpI,OAAA;kBAAAoI,QAAA,EAAQ;gBAAQ;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAQ,CAAC,KAAC,EAACU,GAAG,CAAC1F,OAAO;cAAA;gBAAA6E,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI,CAC9C;YAAA,GAfOW,KAAK;cAAAd,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAgBV,CACN;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC,EAEL1H,iBAAiB,iBAChBd,OAAA;YAAKmI,SAAS,EAAC,oBAAoB;YAAAC,QAAA,eACjCpI,OAAA;cAAAoI,QAAA,gBAAGpI,OAAA;gBAAAoI,QAAA,EAAQ;cAAgB;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC,KAAC,EAAC1H,iBAAiB;YAAA;cAAAuH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACzD,CACN;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC,eAENxI,OAAA;UAAKmI,SAAS,EAAC,kBAAkB;UAAAC,QAAA,gBAC/BpI,OAAA;YAAKmI,SAAS,EAAC,kBAAkB;YAAAC,QAAA,eAC/BpI,OAAA;cACE+I,OAAO,EAAEjB,eAAgB;cACzBK,SAAS,EAAC,cAAc;cACxBkB,KAAK,EAAC,2JAA8B;cAAAjB,QAAA,EACrC;YAED;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CAAC,eAENxI,OAAA;YAAKmI,SAAS,EAAC,oBAAoB;YAAAC,QAAA,EAChC,CAAC1H,WAAW,gBACXV,OAAA;cACE+I,OAAO,EAAEnE,cAAe;cACxBoE,QAAQ,EAAE,CAACxI,WAAY;cACvB2H,SAAS,EAAC,eAAe;cAAAC,QAAA,EAC1B;YAED;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,gBAETxI,OAAA;cACE+I,OAAO,EAAErB,aAAc;cACvBS,SAAS,EAAC,aAAa;cAAAC,QAAA,EACxB;YAED;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ;UACT;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACE,CAAC,eAENxI,OAAA;YAAKmI,SAAS,EAAC,oBAAoB;YAAAC,QAAA,eACjCpI,OAAA;cACE+I,OAAO,EAAEb,YAAa;cACtBc,QAAQ,EAAE,CAACxI,WAAY;cACvB2H,SAAS,EAAC,YAAY;cAAAC,QAAA,EACvB;YAED;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC;MAAA,eACN,CACH,EAEAxH,gBAAgB,iBACfhB,OAAA;QAAKmI,SAAS,EAAC,oBAAoB;QAAAC,QAAA,gBACjCpI,OAAA;UAAAoI,QAAA,EAAI;QAAqB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAI,CAAC,eAC9BxI,OAAA;UAAKmI,SAAS,EAAC,iBAAiB;UAAAC,QAAA,gBAC9BpI,OAAA;YAAAoI,QAAA,gBAAGpI,OAAA;cAAAoI,QAAA,EAAQ;YAAO;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,KAAC,EAACxH,gBAAgB,CAACsI,MAAM;UAAA;YAAAjB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,EACxDxH,gBAAgB,CAACuI,cAAc,iBAC9BvJ,OAAA;YAAKmI,SAAS,EAAC,iBAAiB;YAAAC,QAAA,gBAC9BpI,OAAA;cAAAoI,QAAA,EAAI;YAAoB;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAI,CAAC,eAC7BxI,OAAA;cAAAoI,QAAA,EAAM3E,IAAI,CAACkD,SAAS,CAAC3F,gBAAgB,CAACuI,cAAc,EAAE,IAAI,EAAE,CAAC;YAAC;cAAAlB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAClE,CACN;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAACpI,EAAA,CAvYID,SAAmB;EAAA,QACDL,SAAS;AAAA;AAAA0J,EAAA,GAD3BrJ,SAAmB;AAyYzB,eAAeA,SAAS;AAAC,IAAAqJ,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}