<!DOCTYPE html>
<html>
<head>
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ - HR –ò–Ω—Ç–µ—Ä–≤—å—é</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 600px;
            width: 90%;
        }
        .logo {
            font-size: 48px;
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
        }
        .status.waiting { 
            background: #fff3cd; 
            color: #856404; 
            border: 1px solid #ffeaa7; 
        }
        .status.success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .status.error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        
        .big-button {
            padding: 15px 30px;
            font-size: 18px;
            margin: 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
        }
        .request-btn { 
            background: #28a745; 
            color: white; 
            border: 2px solid #28a745;
        }
        .request-btn:hover { 
            background: #218838; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        .back-btn { 
            background: #007bff; 
            color: white; 
            border: 2px solid #007bff;
        }
        .back-btn:hover { 
            background: #0056b3; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
        }
        .big-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            border-color: #6c757d;
        }
        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }
        .step {
            margin: 10px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .help-text {
            margin-top: 30px; 
            font-size: 14px; 
            color: #666;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .progress-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
        }
        .progress-step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e9ecef;
            color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 10px;
        }
        .progress-step.active {
            background: #007bff;
            color: white;
        }
        .progress-step.completed {
            background: #28a745;
            color: white;
        }
        .progress-line {
            width: 50px;
            height: 2px;
            background: #e9ecef;
        }
        .progress-line.completed {
            background: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üé§</div>
        <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</h1>
        <p class="subtitle">–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É</p>
        
        <div class="progress-indicator">
            <div class="progress-step active" id="step1">1</div>
            <div class="progress-line" id="line1"></div>
            <div class="progress-step" id="step2">2</div>
            <div class="progress-line" id="line2"></div>
            <div class="progress-step" id="step3">3</div>
        </div>
        
        <div id="status" class="status waiting">
            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–æ—Å–∏–ª –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
        </div>
        
        <div>
            <button id="requestBtn" class="big-button request-btn">
                üîê –ó–ê–ü–†–û–°–ò–¢–¨ –î–û–°–¢–£–ü –ö –ú–ò–ö–†–û–§–û–ù–£
            </button>
            <button id="backBtn" class="big-button back-btn" style="display: none;">
                ‚Ü©Ô∏è –í–ï–†–ù–£–¢–¨–°–Ø –ö –ò–ù–¢–ï–†–í–¨–Æ
            </button>
        </div>
        
        <div class="instructions">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
            <div class="step">
                <strong>–®–∞–≥ 1:</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–ê–ü–†–û–°–ò–¢–¨ –î–û–°–¢–£–ü –ö –ú–ò–ö–†–û–§–û–ù–£"
            </div>
            <div class="step">
                <strong>–®–∞–≥ 2:</strong> –í –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –æ–∫–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞–∂–º–∏—Ç–µ <strong>"–†–∞–∑—Ä–µ—à–∏—Ç—å"</strong> –∏–ª–∏ <strong>"Allow"</strong>
            </div>
            <div class="step">
                <strong>–®–∞–≥ 3:</strong> –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –Ω–∞–∂–º–∏—Ç–µ "–í–ï–†–ù–£–¢–¨–°–Ø –ö –ò–ù–¢–ï–†–í–¨–Æ"
            </div>
        </div>
        
        <div class="help-text">
            üí° <strong>–í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
            ‚Ä¢ –ï—Å–ª–∏ —Å–ª—É—á–∞–π–Ω–æ –Ω–∞–∂–∞–ª–∏ "–ó–∞–ø—Ä–µ—Ç–∏—Ç—å", –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞<br>
            ‚Ä¢ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –º–∏–∫—Ä–æ—Ñ–æ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç<br>
            ‚Ä¢ –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö –æ–∫–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
        </div>
    </div>

    <script>
        const status = document.getElementById('status');
        const requestBtn = document.getElementById('requestBtn');
        const backBtn = document.getElementById('backBtn');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const line1 = document.getElementById('line1');
        const line2 = document.getElementById('line2');
        
        function updateStatus(message, type = 'waiting') {
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function updateProgress(currentStep) {
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö —à–∞–≥–æ–≤
            [step1, step2, step3].forEach(step => {
                step.className = 'progress-step';
            });
            [line1, line2].forEach(line => {
                line.className = 'progress-line';
            });
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
            if (currentStep >= 1) {
                step1.className = 'progress-step completed';
            }
            if (currentStep >= 2) {
                step2.className = 'progress-step completed';
                line1.className = 'progress-line completed';
            }
            if (currentStep >= 3) {
                step3.className = 'progress-step completed';
                line2.className = 'progress-line completed';
            }
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
            if (currentStep === 1) step1.className = 'progress-step active';
            if (currentStep === 2) step2.className = 'progress-step active';
            if (currentStep === 3) step3.className = 'progress-step active';
        }
        
        // –ü–æ–ª—É—á–∞–µ–º URL –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        const urlParams = new URLSearchParams(window.location.search);
        const returnUrl = urlParams.get('return') || '/interview';
        
        requestBtn.onclick = async function() {
            try {
                updateStatus('üîç –ó–∞–ø—Ä–∞—à–∏–≤–∞—é –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É... –û–∂–∏–¥–∞–π—Ç–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞!', 'waiting');
                updateProgress(2);
                requestBtn.disabled = true;
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true 
                });
                
                // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞ - –¥–æ—Å—Ç—É–ø –ø–æ–ª—É—á–µ–Ω!
                updateStatus('‚úÖ –û—Ç–ª–∏—á–Ω–æ! –î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –ø–æ–ª—É—á–µ–Ω. –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–Ω—Ç–µ—Ä–≤—å—é.', 'success');
                updateProgress(3);
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫ (–Ω–µ –Ω—É–∂–µ–Ω –±–æ–ª—å—à–µ)
                stream.getTracks().forEach(track => track.stop());
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ–∑–≤—Ä–∞—Ç–∞
                requestBtn.style.display = 'none';
                backBtn.style.display = 'inline-block';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤ localStorage
                localStorage.setItem('microphonePermissionGranted', 'true');
                localStorage.setItem('microphonePermissionTime', Date.now().toString());
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', error);
                
                let errorMessage = '‚ùå ';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage += '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å" –≤ –æ–∫–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage += '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∑–≤—É–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome –∏–ª–∏ Firefox.';
                } else {
                    errorMessage += '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error.message;
                }
                
                updateStatus(errorMessage, 'error');
                updateProgress(1);
                requestBtn.disabled = false;
            }
        };
        
        backBtn.onclick = function() {
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –∏–Ω—Ç–µ—Ä–≤—å—é
            try {
                if (returnUrl.startsWith('http')) {
                    window.location.href = returnUrl;
                } else {
                    window.location.href = window.location.origin + returnUrl;
                }
            } catch (error) {
                // Fallback - –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–∑–∞–¥
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    window.close();
                }
            }
        };
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –±—Ä–∞—É–∑–µ—Ä–æ–º
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            updateStatus('‚ùå –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∑–≤—É–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome, Firefox –∏–ª–∏ Edge.', 'error');
            requestBtn.disabled = true;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ (–≤ —Ç–µ—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 24 —á–∞—Å–æ–≤)
        const permissionGranted = localStorage.getItem('microphonePermissionGranted');
        const permissionTime = localStorage.getItem('microphonePermissionTime');
        const oneDayAgo = Date.now() - (24 * 60 * 60 * 1000);
        
        if (permissionGranted === 'true' && permissionTime && parseInt(permissionTime) > oneDayAgo) {
            updateStatus('‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–æ —Ä–∞–Ω–µ–µ. –ú–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–Ω—Ç–µ—Ä–≤—å—é.', 'success');
            updateProgress(3);
            requestBtn.style.display = 'none';
            backBtn.style.display = 'inline-block';
        } else {
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
            localStorage.removeItem('microphonePermissionGranted');
            localStorage.removeItem('microphonePermissionTime');
            updateProgress(1);
        }
    </script>
</body>
</html>
