<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 50px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; }
        .status { margin: 20px 0; padding: 10px; background: #f0f0f0; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
    </style>
</head>
<body>
    <h1>üé§ –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞</h1>
    
    <div id="status" class="status">
        –°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
    </div>
    
    <button id="requestPermission">1Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ</button>
    <button id="startRecord" disabled>2Ô∏è‚É£ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
    <button id="stopRecord" disabled>3Ô∏è‚É£ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    <button id="playback" disabled>4Ô∏è‚É£ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
    
    <div id="log"></div>
    
    <script>
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        
        const status = document.getElementById('status');
        const log = document.getElementById('log');
        const requestBtn = document.getElementById('requestPermission');
        const startBtn = document.getElementById('startRecord');
        const stopBtn = document.getElementById('stopRecord');
        const playBtn = document.getElementById('playback');
        
        function updateStatus(message, type = '') {
            status.innerHTML = message;
            status.className = `status ${type}`;
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(logEntry);
        }
        
        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
        requestBtn.onclick = async () => {
            try {
                updateStatus('–ó–∞–ø—Ä–∞—à–∏–≤–∞—é —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω...', '');
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                updateStatus('‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ!', 'success');
                
                startBtn.disabled = false;
                requestBtn.disabled = true;
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ç–æ–∫
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: ${error.message}`, 'error');
                console.error('Microphone error:', error);
            }
        };
        
        // –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
        startBtn.onclick = async () => {
            try {
                audioChunks = [];
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                        updateStatus(`üìä –ó–∞–ø–∏—Å–∞–Ω–æ ${audioChunks.length} —á–∞–Ω–∫–æ–≤`, '');
                    }
                };
                
                mediaRecorder.onstop = () => {
                    audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    updateStatus(`üéµ –ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –†–∞–∑–º–µ—Ä: ${audioBlob.size} –±–∞–π—Ç`, 'success');
                    
                    playBtn.disabled = false;
                    startBtn.disabled = false;
                    stopBtn.disabled = true;
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Ç—Ä–µ–∫–∏
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.start(500); // –ß–∞–Ω–∫–∏ –∫–∞–∂–¥—ã–µ 500–º—Å
                updateStatus('üî¥ –ó–∞–ø–∏—Å—å –Ω–∞—á–∞–ª–∞—Å—å...', '');
                
                startBtn.disabled = true;
                stopBtn.disabled = false;
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏: ${error.message}`, 'error');
                console.error('Recording error:', error);
            }
        };
        
        // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
        stopBtn.onclick = () => {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                updateStatus('‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏...', '');
            }
        };
        
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        playBtn.onclick = () => {
            if (audioBlob) {
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);
                
                audio.onplay = () => updateStatus('üîä –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ...', '');
                audio.onended = () => {
                    updateStatus('‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
                    URL.revokeObjectURL(audioUrl);
                };
                audio.onerror = (e) => updateStatus(`‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ${e}`, 'error');
                
                audio.play();
            }
        };
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            updateStatus('‚ùå –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ', 'error');
        } else {
            updateStatus('‚úÖ –ë—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ', 'success');
        }
    </script>
</body>
</html>
